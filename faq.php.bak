<?php
  $status = session_status();
  if ($status == PHP_SESSION_NONE) {
    session_start();
  }
?>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FAQs | Learn and Help</title>
  <link rel="icon" href="images/icon_logo.png" type="image/icon type">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;900&display=swap" rel="stylesheet">
  <link href="css/main.css" rel="stylesheet">
  
  
  <style>
  /* Layout */
  .faq-container { max-width: 900px; margin: 32px auto; padding: 0 16px; }
  .faq-title { font-size: 2rem; font-weight: 900; margin: 0 0 16px; }
  .faq-sub-title { font-size: 1rem; font-weight: 900; margin: 0 0 16px; }

  /* Cards */
  details {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.06);
    margin: 12px 0;
    padding: 0;
  }
  details[open] { box-shadow: 0 8px 24px rgba(0,0,0,0.08); }

  /* Question line */
  summary {
    cursor: pointer;
    padding: 16px 20px;
    font-weight: 700;
    list-style: none;
    display: block;          /* ensure consistent left alignment */
  }
  summary::-webkit-details-marker { display: none; }

  /* Answer text */
  .faq-answer {
    padding: 0 20px 18px 20px;
    line-height: 1.55;
    color: #333;
  }

  /* Force Q & A left-aligned (overrides any global centering) */
  .faq-container,
  .faq-container details,
  .faq-container summary,
  .faq-container .faq-answer { text-align: left; }

  /* Hard override in case a global !important centers text */
  .faq-container summary,
  .faq-container .faq-answer { text-align: left !important; }

  /* Meta & empty states */
  .faq-meta { font-size: 0.875rem; color: #666; margin-top: 8px; text-align: right; }
  .faq-empty { background: #fff; border-radius: 12px; padding: 16px; text-align: center; color: #666; }
</style>

  
</head>
<body>
<?php include 'show-navbar.php'; show_navbar(); ?>

<div class="faq-container">
  <h1 class="faq-title">Frequently Asked Questions</h1>
  <h3 class="faq-sub-title">Click the question to see the answer</h3>
  
  <?php
    $faqsPath = __DIR__ . '/faqs.txt';

    /**
     * Parse a faqs.txt file where questions start with "Q:" and answers start with "A:".
     * Supports multi-line answers (lines after A: until the next Q: belong to that answer).
     */
    function parseFaqFile(string $path): array {
        if (!is_file($path)) return [];

        $content = file_get_contents($path);
        if ($content === false) return [];

        $lines = preg_split("/\R/", $content);
        $faqs = [];
        $currentQ = null;
        $currentA = [];

        foreach ($lines as $raw) {
            $line = trim($raw);
            if ($line === '') {
                // allow empty lines inside answers; just continue
                if ($currentQ !== null && !empty($currentA)) {
                    $currentA[] = ''; // preserve paragraph breaks
                }
                continue;
            }

            if (stripos($line, 'Q:') === 0) {
                // finalize previous Q/A if any
                if ($currentQ !== null) {
                    $faqs[] = [
                        'q' => $currentQ,
                        'a' => rtrim(implode("\n", $currentA))
                    ];
                    $currentA = [];
                }
                $currentQ = ltrim(substr($line, 2));
                continue;
            }

            if (stripos($line, 'A:') === 0) {
                $currentA[] = ltrim(substr($line, 2));
            } else {
                // continuation for multi-line answers
                if ($currentQ !== null) {
                    $currentA[] = $line;
                }
            }
        }

        // finalize last block
        if ($currentQ !== null) {
            $faqs[] = [
                'q' => $currentQ,
                'a' => rtrim(implode("\n", $currentA))
            ];
        }
        return $faqs;
    }

    $faqs = parseFaqFile($faqsPath);

    if (empty($faqs)) {
        echo '<div class="faq-empty">No FAQs available right now. Please check back later.</div>';
    } else {
        foreach ($faqs as $idx => $item) {
            $q = htmlspecialchars($item['q'] ?? '', ENT_QUOTES, 'UTF-8');
            $a = nl2br(htmlspecialchars($item['a'] ?? '', ENT_QUOTES, 'UTF-8'));
            echo '<details'.($idx === 0 ? ' open' : '').'>';
            echo '  <summary>' . $q . '</summary>';
            echo '  <div class="faq-answer">' . $a . '</div>';
            echo '</details>';
        }

        // optional "last updated" stamp based on file mtime
        $mtime = @filemtime($faqsPath);
        if ($mtime) {
            echo '<div class="faq-meta">Last updated: ' . date('F j, Y, g:i a', $mtime) . '</div>';
        }
    }
  ?>
</div>

<?php include 'footer.php'; ?>
</body>
</html>
